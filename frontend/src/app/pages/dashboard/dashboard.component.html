<section class="dashboard">
  <div class="dash-header">
    <div>
      <p class="eyebrow">Servers</p>
      <h1>Your servers</h1>
      <p class="hint">Manage listings, callbacks, rewards, and performance.</p>
    </div>
  </div>

  <nav class="tab-bar">
    <button class="tab" [class.active]="activeTab === 'dashboard'" (click)="setTab('dashboard')" type="button">
      <span class="material-icon">dashboard</span> Overview
    </button>
    <button class="tab" [class.active]="activeTab === 'add'" (click)="setTab('add')" type="button">
      <span class="material-icon">add_circle</span> Add server
    </button>
    <button class="tab" [class.active]="activeTab === 'list'" (click)="setTab('list')" type="button">
      <span class="material-icon">dns</span> My servers
    </button>
    <button class="tab" [class.active]="activeTab === 'settings'" (click)="setTab('settings')" type="button">
      <span class="material-icon">settings</span> Settings
    </button>
  </nav>

  <div class="layout">
    <aside class="sidebar">
      <h3>My servers</h3>
      <div class="hotel-list">
        <div
          *ngFor="let hotel of hotels"
          class="hotel-item"
          [class.active]="hotel === selectedHotel"
          (click)="onSidebarSelect(hotel)"
        >
          <div class="hotel-header row">
            <div class="hotel-title-stack">
              <div class="hotel-name">{{ hotel.name }}</div>
              <div class="hotel-slug">{{ hotel.slug }}</div>
            </div>
            <img class="server-icon-large" [src]="getServerIcon(hotel)" [alt]="getServerLabel(hotel)" />
          </div>
          <div class="hotel-meta">
            <div class="hotel-stats">
              <span class="stat-line">
                <span class="material-icon">how_to_vote</span>{{ hotel.totalVotes || 0 }} Total votes
              </span>
              <span class="stat-line">
                <span class="material-icon">visibility</span>{{ hotel.views || 0 }} Total views
              </span>
            </div>
            <span class="ago-badge">{{ getRelativeTime(hotel.createdAt) }}</span>
          </div>
        </div>
        <p *ngIf="!hotels.length" class="empty">No servers yet.</p>
        <p *ngIf="error" class="empty error">{{ error }}</p>
      </div>
    </aside>

    <div class="content">
      <app-overview *ngIf="activeTab === 'dashboard'" [selectedHotel]="selectedHotel"></app-overview>

      <app-add-server
        *ngIf="activeTab === 'add'"
        [pool]="pool"
        (poolChange)="selectPool($event)"
        (hotelCreated)="onHotelCreated($event)"
      ></app-add-server>

      <app-my-servers
        *ngIf="activeTab === 'list'"
        [hotels]="hotels"
        [editingId]="editingId"
        [editingModel]="editingModel"
        [selectedHotel]="selectedHotel"
        [loading]="loading"
        [error]="error"
        (startEdit)="startEdit($event)"
        (cancelEdit)="cancelEdit()"
        (saveEdit)="saveEdit($event)"
        (deleteHotel)="confirmDeleteHotel($event)"
        (selectHotelForView)="selectHotel($event); setTab('dashboard')"
      ></app-my-servers>

      <app-settings
        *ngIf="activeTab === 'settings'"
        [profile]="profile"
        [passwordForm]="passwordForm"
        [showCurrent]="showCurrent"
        [showNew]="showNew"
        [passwordLoading]="passwordLoading"
        [profileMessage]="profileMessage"
        [profileError]="profileError"
        [passwordMessage]="passwordMessage"
        [passwordError]="passwordError"
        (saveProfileEvent)="saveProfile()"
        (updatePasswordEvent)="updatePassword()"
        (confirmDeleteAccountEvent)="confirmDeleteAccount()"
        (logoutEvent)="logout()"
        (toggleShowCurrent)="showCurrent = !showCurrent"
        (toggleShowNew)="showNew = !showNew"
      ></app-settings>
    </div>
  </div>

  <app-confirm-dialog
    *ngIf="showDeleteServerDialog && deleteTarget"
    [title]="'Delete ' + (deleteTarget?.name || 'server') + '?'"
    description="This will remove the server and its stats. This cannot be undone."
    confirmLabel="{{ deleteLoading ? 'Deletingâ€¦' : 'Delete server' }}"
    cancelLabel="Cancel"
    [loading]="deleteLoading"
    (confirm)="!deleteLoading && deleteHotel(deleteTarget)"
    (cancel)="cancelDeleteHotel()"
  ></app-confirm-dialog>

  <app-confirm-dialog
    *ngIf="showDeleteDialog"
    title="Delete account?"
    description="This will remove your account and all your servers permanently."
    confirmLabel="Delete account"
    cancelLabel="Cancel"
    (confirm)="deleteAccount()"
    (cancel)="cancelDelete()"
  ></app-confirm-dialog>
</section>
